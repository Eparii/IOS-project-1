#!/bin/sh

export POSIXLY_CORRECT=yes
    WIDTH=3

    EDITED="cat stock-2.log | sort -t\; -k2,2 -k1,1 -r | awk -F\; -v j="1" '{
    {ArrayTickers[NR]=\$2}
    if(ArrayTickers[NR] != ArrayTickers[NR-1])
    {
      {LAST_PRICE[j]=\$4}
      {j++}
    }
    if(\$3 == \"sell\")
    {       
      ArrayHolding[NR]-=\$6
    }
    else
    {
      ArrayHolding[NR]+=\$6
    }
    }
    END {{j=1} for(i=1;i<=NR+1;i++){
      if(ArrayTickers[i] == ArrayTickers[i-1]) 
      {
        ArrayHolding[i]+=ArrayHolding[i-1]
      }
      else if (i == 1) {continue}
      else
      {
              {ACT=ArrayHolding*LAST_PRICE[j]}
        {DIVIDENT=MAX/WIDTH}
        {WRITE=int(ACT/DIVIDENT)}
        {OUTPUT=\"\"}
        if ( WRITE >= 0 )
        {
          for (j=0; j < WRITE; j++) {OUTPUT=OUTPUT \"#\"}
        }
        else 
        {
          for(j=0; j < WRITE; j++) { OUTPUT=OUTPUT \"!\" }
        }
        {printf \"%-10s: %*.2f\n\", ArrayTickers[i-1], ACT}
        {j++}
      }
}}'"
   
eval $EDITED
